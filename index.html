<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>N棱柱外翻控制</title>
    <style>
        :root {
            /* 比例 10 : 1 : 20 */
            --l: 100px; 
            --w: 10px;  
            --h: 200px; 
            
            /* 动态控制变量 */
            --n: 4;
            --offset: 50px;
            --theta: 0deg;

            /* 木材色调 */
            --wood-main: #8B4513;
            --wood-side: #5D2E0C;
            --wood-top: #A0522D;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #111;
            perspective: 2000px;
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        /* 控制器样式 */
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(45, 45, 45, 0.95);
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #444;
            min-width: 260px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .control-group { margin-bottom: 25px; }
        .control-group:last-child { margin-bottom: 0; }
        .control-group label { display: block; margin-bottom: 10px; font-size: 14px; color: #aaa; letter-spacing: 0.5px; }
        .val-display { color: #00d1ff; font-weight: bold; float: right; font-family: monospace; font-size: 16px; }
        
        input[type="range"] { 
            width: 100%; 
            cursor: pointer;
            accent-color: #00d1ff;
        }

        /* 3D 场景 */
        .scene {
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(-25deg) rotateY(35deg);
        }

        /* 桌面纹理 */
        .table {
            position: absolute;
            width: 1600px;
            height: 1600px;
            background: #1a1a1a;
            transform: translate(-50%, -50%) rotateX(90deg);
            background-image: 
                radial-gradient(circle, #333 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 40px 40px, 120px 120px;
            border: 2px solid #222;
        }

        .prism-group {
            position: absolute;
            transform-style: preserve-3d;
        }

        .block-anchor {
            position: absolute;
            transform-style: preserve-3d;
        }

        .block {
            position: absolute;
            width: var(--l);
            height: var(--h);
            left: calc(var(--l) / -2);
            bottom: 0;
            transform-style: preserve-3d;
            
            /* 关键点：旋转轴在底面最外侧长边 */
            transform-origin: center bottom var(--w);
            
            /* 向外翻转角度 theta */
            transform: rotateX(calc(-1 * var(--theta)));
            transition: transform 0.1s linear;
        }

        .face {
            position: absolute;
            box-sizing: border-box;
            border: 1px solid rgba(0,0,0,0.4);
        }

        /* 木块面渲染 */
        .front { width: var(--l); height: var(--h); background: var(--wood-main); transform: translateZ(var(--w)); }
        .back  { width: var(--l); height: var(--h); background: var(--wood-main); transform: rotateY(180deg); }
        .left  { width: var(--w); height: var(--h); background: var(--wood-side); transform: rotateY(-90deg); transform-origin: left; }
        .right { width: var(--w); height: var(--h); background: var(--wood-side); transform: rotateY(90deg); transform-origin: right; right: 0; }
        .top    { width: var(--l); height: var(--w); background: var(--wood-top); transform: rotateX(90deg); transform-origin: top; }
        .bottom { width: var(--l); height: var(--w); background: var(--wood-top); transform: rotateX(-90deg); transform-origin: bottom; bottom: 0; }

    </style>
</head>
<body>

    <div class="controls">
        <div class="control-group">
            <label>木块数量 (n): <span id="n-val" class="val-display">4</span></label>
            <input type="range" id="n-slider" min="3" max="20" value="4">
        </div>
        <div class="control-group">
            <label>外翻控制 (theta): <span id="theta-val" class="val-display">0</span>°</label>
            <input type="range" id="theta-slider" min="0" max="90" value="0">
        </div>
    </div>

    <div class="scene">
        <div class="table"></div>
        <div id="prism" class="prism-group"></div>
    </div>

    <script>
        const nSlider = document.getElementById('n-slider');
        const thetaSlider = document.getElementById('theta-slider');
        const nText = document.getElementById('n-val');
        const thetaText = document.getElementById('theta-val');
        const prism = document.getElementById('prism');

        function update() {
            const n = parseInt(nSlider.value);
            const theta = parseInt(thetaSlider.value);
            
            nText.innerText = n;
            thetaText.innerText = theta;
            
            // 几何参数
            const l = 100; // 木块长
            const angleRad = (180 / n) * (Math.PI / 180);
            
            // 计算 offset 使 n 块木块拼成紧密的棱柱
            const offset = (l / 2) / Math.tan(angleRad);
            
            document.documentElement.style.setProperty('--offset', `${offset}px`);
            document.documentElement.style.setProperty('--theta', `${theta}deg`);

            // 动态构建或更新木块
            if (prism.children.length !== n) {
                prism.innerHTML = '';
                for (let i = 0; i < n; i++) {
                    const anchor = document.createElement('div');
                    anchor.className = 'block-anchor';
                    // 每一个锚点绕中心旋转 i * (360/n) 度并向外推移 offset
                    anchor.style.transform = `rotateY(${i * (360 / n)}deg) translateZ(var(--offset))`;
                    
                    anchor.innerHTML = `
                        <div class="block">
                            <div class="face front"></div><div class="face back"></div>
                            <div class="face left"></div><div class="face right"></div>
                            <div class="face top"></div><div class="face bottom"></div>
                        </div>
                    `;
                    prism.appendChild(anchor);
                }
            } else {
                // 仅更新旋转位置
                Array.from(prism.children).forEach((child, i) => {
                    child.style.transform = `rotateY(${i * (360 / n)}deg) translateZ(var(--offset))`;
                });
            }
        }

        nSlider.oninput = update;
        thetaSlider.oninput = update;
        update(); // 初始化渲染
    </script>
</body>
</html>